---
title: 从PLC对接实践看复杂指令与精简指令的设计哲学
date: 2026-01-19 22:25:16
tags: [架构设计, PLC, 软件工程]
---

最近在项目中负责对接PLC设备,遇到了一些看似简单,却让自己深思的场景。

系统需要控制设备在预设的多个点位之间移动。在初始方案中,PLC内部预设了5个固定点位:
- 点位1:实际位置 0
- 点位2:实际位置 100
- 点位3:实际位置 300
- ...

控制协议采用线圈地址写入方式,通过连续写入N个布尔值来选择目标点位,类似OneHot编码:`[false, true, false, false, false]` 表示移动到第2个点位。

项目进入现场调试阶段后,实际工况要求将预设点位从5个扩展到10个,这带来了一系列调整:

1. **PLC端**:PLC工程师需要重新编写程序,调整内部预设的点位数量
2. **调用方**:软件层面需要修改线圈起始地址配置 
3. **数据格式**:OneHot数组长度变化,通信协议需要相应调整
4. **联调时间**:双方需要重新测试验证所有点位

在实际联调过程中,由于PLC程序端的改动在向前兼容方面存在一些疏漏,导致出现了异常情况。我们花费了较长时间才排查到根本原因——那天加班到了凌晨四点。

整个变更过程相对耗时,且容易因为细节问题产生错误。

或许可以考虑另一种思路? 一个可能更灵活的方案

在与PLC工程师沟通后,了解到PLC实际上已经具备(或者可以相对容易地提供)以下能力:
- 动态设置点位的目标位置
- 控制启动/停止
- 调节移动速度

那，是否可以尝试用不同的思路来设计:

**不预设固定点位,或者只设计一个目标点位,每次移动前动态设置目标位置。**

具体实现思路:
```
1. 上层应用从数据库读取点位配置(支持动态增删)
2. 发送目标位置数值到PLC
3. 发送启动指令
4. 等待移动完成
```

这种方案可能带来一些优势:
- **可扩展性**:增减点位只需修改数据库配置,理论上无需改动程序
- **灵活性**:点位坐标可随时调整,无需重新烧录PLC程序
- **简化接口**:保持相对固定的通信协议,不因点位数量变化而改变
- **易维护性**:业务逻辑上移到应用层,可能便于调试和优化

等等。

其实还有一个需求当时双方没有完全实现,就是希望速度能够动态调整。

目前整个采集过程中,速度是固定的(设置了一个固定值)。但在实际使用中,当前后两点距离较近时,希望速度更慢一些;当前后两点距离较大时,能以相对快的速度移动，用于节约单个周期的用时。

如果按照原有的预设点位方案,要实现这个功能可能会比较困难。而采用简化后的设计思路,或许可以将这种较为复杂的逻辑交由软件层面来实现和传递。

突然脑子里就闪过了，计算机体系结构中的一个经典话题:**复杂指令集(CISC)与精简指令集(RISC)**。

**初版方案(偏向复杂指令的思路)**:
- 将多个点位配置硬编码在底层(PLC)
- 一条指令完成"选择并移动到预设点位"的复杂操作
- 功能看似集中,但在应对变化时可能不够灵活

**优化方案(偏向精简指令的思路)**:
- 底层只提供最基本的原子操作:设置位置、启动、停止
- 上层应用组合基础指令来完成复杂任务
- 在一定程度上体现了"机制与策略分离"的设计理念


也同时闪过了**开闭原则**:

> 软件实体应当对扩展开放,对修改关闭。

- **对扩展开放**:通过数据库配置新增点位,理论上可以避免修改代码
- **对修改关闭**:底层PLC程序和通信接口可以保持相对稳定

同时也在某种程度上体现了**单一职责原则**:
- PLC专注于运动控制的底层机制
- 应用层负责业务逻辑和策略配置
- 数据库管理配置数据的持久化


重新思考**简单性**和**可组合性**的价值：

1. **底层保持简洁和通用或许更合适**,可以考虑避免过早地将业务逻辑固化在底层
2. **复杂性适当上移到更灵活的层次**,可能便于后续的调整和扩展
3. **设计时值得考虑"变化"的可能方向**,尝试将易变部分与稳定部分适度隔离
4. **原子操作的组合有时比复杂指令更具潜力**,这似乎也是Unix哲学所倡导的

正如RISC架构在许多场景下展现出了良好的性能和能效,在软件设计中,简洁、正交的接口或许也比功能复杂的"一站式"方案更值得考虑。

**少即是多(Less is More)**,这不仅是一种设计美学,或许也蕴含着一些工程智慧